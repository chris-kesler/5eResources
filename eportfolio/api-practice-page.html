<!DOCTYPE html>
<!-- =========================================================================================
  This is a DIRECTORY page.  It contains HEADER, BACKGROUND, CONTENT, and FOOTER elements that are standard across the site.
  It also contains TITLE, PAGE LIST, and DESCRIPTION elements that are unique and static as a DIRECTORY page.
========================================================================================= -->
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-US-Compatible" content="e-edge">
    <title>KnowOne's Website of Everything</title>
    <link rel="icon" href="/resources/images/OwlOfMinerva_ModifiedLogo.png">
    <link rel="stylesheet" href="/caped-crusaders-style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>

      // A function that capitalizes the first letter of each word in a string
      function titleCase(str) {
        var split_string = str.toLowerCase().split(' ');
        for (var i = 0; i < split_string.length; i++) {
          split_string[i] = split_string[i].charAt(0).toUpperCase() + split_string[i].substring(1);     
        }
        return split_string.join(' '); 
      }


      // The function that populates all page data into preset elements
      $(function populatePageData() {


// =========================================================================================
// Populating the page HEADER
// 
// The page HEADER, BACKGROUND, CONTENT, and FOOTER are static
// =========================================================================================
        $("#import-header").load("/resources/pages/import-header.html");


// =========================================================================================
// Populating the page FOOTER
// 
// The page HEADER, BACKGROUND, CONTENT, and FOOTER are static
// =========================================================================================
        $("#import-footer").load("/resources/pages/import-footer.html");
      });

      const getResults = (id) => {
      fetch(`https://www.dnd5eapi.co/api/${id}`)
        .then(response => response.json())
        .then((data) => {
          const result = {
            name: data.name,
            level: data.level,
            casting_time: data.casting_time,
            range: data.range,
            components: data.components,
            source: data.url,
            duration: data.duration,
            school: data.school.name,
            attack_type: data.attack_type,
            damage_effect: data.damage
          }       

      tableRow = `
      <tr>
        <th>
          Name
        </th>
        <th>
          Level
        </th>
        <th>
          Casting Time
        </th>
        <th>
          Range/Area
        </th>
        <th>
          Components
        </th>
      </tr>`
      $(tableRow).appendTo("#page-title-table-wide tbody");

      tableRow = `
      <tr>
        <td>
          ${result.name}
        </td>
        <td>
          ${result.level}
        </td>
        <td>
          ${result.casting_time}
        </td>
        <td>
          ${result.range}
        </td>
        <td>
          ${result.components}
        </td>
      </tr>`
      $(tableRow).appendTo("#page-title-table-wide tbody");

      tableRow = `
      <tr>
        <th>
          Source
        </th>
        <th>
          Duration
        </th>
        <th>
          School
        </th>
        <th>
          Attack/Save
        </th>
        <th>
          Damage/Effect
        </th>
      </tr>`
      $(tableRow).appendTo("#page-title-table-wide tbody");

      if(data.damage != undefined) {
        tableRow = `
        <tr>
          <td>
            ${result.source}
          </td>
          <td>
            ${result.duration}
          </td>
          <td>
            ${result.school}
          </td>
          <td>
            ${result.attack_type}
          </td>
          <td>
            ${result.damage_effect.damage_type.name}
          </td>
        </tr>`
        $(tableRow).appendTo("#page-title-table-wide tbody");
      } else {
        tableRow = `
        <tr>
          <td>
            ${result.source}
          </td>
          <td>
            ${result.duration}
          </td>
          <td>
            ${result.school}
          </td>
          <td>
            ${result.attack_type}
          </td>
          <td>
            undefined
          </td>
        </tr>`
        $(tableRow).appendTo("#page-title-table-wide tbody");
      }

      });  
      }


      getResults("spells/acid-arrow");
    </script>
  </head>  


  <body>
    <!-- 
      A div for the page BACKGROUND -->
    <div id="page-background-div-eportfolio">
      <!-- 
        A div for the page HEADER -->
      <div id="import-header"></div>
      <!-- 
        A section for the page CONTENT -->
      <section class="page-content-section">
        <!-- 
          A table for the page TITLE -->
        <table id="page-title-table-wide"><thead><tr><td colspan="6"><h2 id="page-title-path"><a href='/eportfolio.html'>Christian Kesler's B.Sc. of Computer Science Capstone ePortfolio</a> > API Practice Page</h2></td></tr></thead><tbody></tbody></table>   
        <!-- 
          A div for the page DESCRIPTION -->
        <div id="page-description-div">
            <div id="dnd-api-element"></div>
        </div>
      </section>
      <!-- 
        A div for the page FOOTER -->
      <footer id="import-footer"></footer>
    </div>
  </body>
</html>