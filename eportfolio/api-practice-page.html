<!DOCTYPE html>
<!-- =========================================================================================
This is a DIRECTORY page.  It contains HEADER, BACKGROUND, CONTENT, and FOOTER elements that are standard across the site.
It also contains TITLE, PAGE LIST, and DESCRIPTION elements that are unique and static as a DIRECTORY page.
========================================================================================= -->
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-US-Compatible" content="e-edge">
	<title>KnowOne's Website of Everything</title>
	<link rel="icon" href="/resources/images/OwlOfMinerva_ModifiedLogo.png">
	<link rel="stylesheet" href="/caped-crusaders-style.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script>

		// A function that capitalizes the first letter of each word in a string
		function titleCase(str) {
		var split_string = str.toLowerCase().split(' ');
		for (var i = 0; i < split_string.length; i++) {
			split_string[i] = split_string[i].charAt(0).toUpperCase() + split_string[i].substring(1);     
		}
		return split_string.join(' '); 
		}


		// The function that populates all page data into preset elements
		$(function populatePageData() {


// =========================================================================================
// Populating the page HEADER
// 
// The page HEADER, BACKGROUND, CONTENT, and FOOTER are static
// =========================================================================================
		$("#import-header").load("/resources/pages/import-header.html");


// =========================================================================================
// Populating the page FOOTER
// 
// The page HEADER, BACKGROUND, CONTENT, and FOOTER are static
// =========================================================================================
		$("#import-footer").load("/resources/pages/import-footer.html");
		});

		const getResults = (id) => {
			fetch(`https://www.dnd5eapi.co${id}`)
				.then(response => response.json())
				.then((data) => {
					// Looping through the JSON data 
					$.each(data.results, function(i, f) {
						fetch(`https://www.dnd5eapi.co${f.url}`)
							.then(response => response.json())
							.then((data) => {
								const result = {
									index: data.index,
									name: data.name,
									level: data.level,
									school: data.school.name,
									casting_time: data.casting_time,
									range: data.range,
									components: data.components,
									duration: data.duration,
									attack: data.attack_type,
									save: data.dc,
									damage: data.damage,
									higher_level: data.higher_level,
									classes: data.classes,
									source: f.url,

									// level: data.name,
									// casting_time: data.name,
									// range: data.name,
									// components: data.name,
									// source: data.name,
									// duration: data.name,
									// school: data.name,
									// attack: data.name,
									// damage_effect: data.name,
								}


								var table_row = `
								<tr>
									<td>
										${result.name}
									</td>
									<td>
										Level: ${result.level}
									</td>
									<td>
										<img class='directory-page-dynamic-table-entry-image' src=/resources/images/${result.school}.png><br>
										${result.school}
									</td>
									<td>
										${result.casting_time}
									</td>
									<td>
										${result.range}
									</td> 
									<td>
										${result.components}
									</td>
									<td>
										${result.duration}
									</td>`
								if (result.attack != undefined) {
									table_row += `
									<td>
										${result.attack}
									</td>
								`
								} else if (result.save != undefined) {
									table_row += `
									<td>
										${result.save.dc_type.name}
									</td>
									`
								} else {
									table_row += `
									<td>
										NA
									</td>
									`
								}
								if (result.damage != undefined) {
									table_row += `
									<td>
										${result.damage.damage_type.name}
									</td>
								`
								} else {
									table_row += `
									<td>
										NA
									</td>
									`
								}
								if (result.higher_level.length != 0) {
									table_row += `
									<td>
										True
									</td>
								`
								} else {
									table_row += `
									<td>
										False
									</td>
									`
								}
								table_row += `
									<td>
									`
								for (let z = 0; z < result.classes.length; z++) {
									table_row += `
									${result.classes[z].name}, 
									`
								}
								table_row += `
									</td>
									<td>
										${result.source}
									</td>
								</tr>
								`
								$(table_row).appendTo("#directory-page-dynamic-table-content tbody");


								// tableRow = `
								// <tr>
								// 	<th>
								// 	Name
								// 	</th>
								// 	<th>
								// 	Level
								// 	</th>
								// 	<th>
								// 	Casting Time
								// 	</th>
								// 	<th>
								// 	Range/Area
								// 	</th>
								// 	<th>
								// 	Components
								// 	</th>
								// </tr>`
								// $(tableRow).appendTo("#directory-page-dynamic-table-content tbody");

								// tableRow = `
								// <tr>
								// 	<td>
								// 	${result.name}
								// 	</td>
								// 	<td>
								// 	${result.level}
								// 	</td>
								// 	<td>
								// 	${result.casting_time}
								// 	</td>
								// 	<td>
								// 	${result.range}
								// 	</td>
								// 	<td>
								// 	${result.components}
								// 	</td>
								// </tr>`
								// $(tableRow).appendTo("#directory-page-dynamic-table-content tbody");

								// tableRow = `
								// <tr>
								// 	<th>
								// 	Source
								// 	</th>
								// 	<th>
								// 	Duration
								// 	</th>
								// 	<th>
								// 	School
								// 	</th>
								// 	<th>
								// 	Attack/Save
								// 	</th>
								// 	<th>
								// 	Damage/Effect
								// 	</th>
								// </tr>`
								// $(tableRow).appendTo("#directory-page-dynamic-table-content tbody");

								// if(result.damage_effect != undefined) {
								// 	tableRow = `
								// 	<tr>
								// 	<td>
								// 		${result.source}
								// 	</td>
								// 	<td>
								// 		${result.duration}
								// 	</td>
								// 	<td>
								// 		${result.school}
								// 	</td>
								// 	<td>
								// 		${result.attack}
								// 	</td>
								// 	<td>
								// 		${result.damage_effect.damage_type.name}
								// 	</td>
								// 	</tr><tr><td><td></tr>`
								// 	$(tableRow).appendTo("#directory-page-dynamic-table-content tbody");
								// } else {
								// 	tableRow = `
								// 	<tr>
								// 	<td>
								// 		${result.source}
								// 	</td>
								// 	<td>
								// 		${result.duration}
								// 	</td>
								// 	<td>
								// 		${result.school}
								// 	</td>
								// 	<td>
								// 		${result.attack}
								// 	</td>
								// 	<td>
								// 		undefined
								// 	</td>
								// 	</tr><tr class='empty-row'><td><td></tr>`
								// 	$(tableRow).appendTo("#directory-page-dynamic-table-content tbody");
								// }
							});
					});
				});
		}

		function CallApiSearchEngine() {
			var query = document.getElementById('5e-srd-api-searchbox').value;
			// document.getElementById('page-description-div').innerHTML = query;
			$('#directory-page-dynamic-table-content tr').remove();
			getResults(`/api/spells/?name=${query}`);

		}

		getResults("/api/spells/");
	</script>
</head>  


	<body>
		<!-- 
			A div for the page BACKGROUND -->
		<div id="page-background-div-eportfolio">
			<!-- 
			A div for the page HEADER -->
			<div id="import-header"></div>
			<!-- 
			A section for the page CONTENT -->
			<section class="page-content-section">
				<!-- 
					A table for the page TITLE -->
				<table id="page-title-table-wide"><thead><tr><td colspan="6"><h2 id="page-title-path"><a href='/eportfolio.html'>Christian Kesler's B.Sc. of Computer Science Capstone ePortfolio</a> > API Practice Page</h2></td></tr></thead><tbody></tbody></table>   

				<input type='text' id='5e-srd-api-searchbox' class='directory-page-dynamic-table-query-input' placeholder='Search the 5E SRD API for Spells. . .'>

				<button onclick="CallApiSearchEngine()">Perform Search</button>

				<!-- 
					A div for the page DESCRIPTION -->
				<div id="page-description-div">
						<div id="dnd-api-element"></div>
				</div>

				<!-- This is the table that contains the entries being filtered -->
				<h3>API Search Engine Results</h3>
				<table id="directory-page-dynamic-table-content">
					<!-- The buttons that designate the column data and serve as the header can be clicked to sort the entries in ascending or descending order -->
					<thead class="header" id="directory-page-dynamic-table-header"></thead>

					<!-- The empty table body, which is populated from a JSON file using the above script  -->
					<tbody></tbody>
				</table>

			</section>
			<!-- 
			A div for the page FOOTER -->
			<footer id="import-footer"></footer>
		</div>
	</body>
</html>