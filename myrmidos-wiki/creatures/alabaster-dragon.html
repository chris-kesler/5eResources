<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-US-Compatible" content="e-edge">
    <title>KnowOne's Website of Everything</title>
    <link rel="icon" href="/resources/images/OwlOfMinerva_ModifiedLogo.png">
    <link rel="stylesheet" href="/caped-crusaders-style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>  
    <script>
      function titleCase(str) {
        var split_string = str.toLowerCase().split(' ');
        for (var i = 0; i < split_string.length; i++) {
          split_string[i] = split_string[i].charAt(0).toUpperCase() + split_string[i].substring(1);     
        }
        return split_string.join(' '); 
      }

      $(function populatePageData() {


// =========================================================================================
// Populating the page HEADER
// =========================================================================================
        $("#import-header").load("/resources/pages/import-header.html");


// =========================================================================================
// BACKGROUND and CONTENT are static
// Populating the page TITLE
// =========================================================================================
        
        // Reading the name of this file
        var page_array = window.location.pathname.split("/");
        var page_title = page_array.pop();
        var page_directory = page_array.pop();
        var page_subsite = page_array.pop();

        // Reading data from our JSON file
        $.getJSON(`/` + page_subsite + `/` + page_directory + `.json`, function(data) {

          // Looping through the JSON data 
          $.each(data.entries, function(i, f) {

            // Finding the entry that matches this file
            if (f.entry_name.toLowerCase().replace(/\s/g, '-').replace("'", "") + ".html" == page_title) {

              // Populating the name of the page
              if (f.content_source != undefined){
                document.getElementById("page-title-table-path").innerHTML = "<a href='/" + page_subsite + ".html'>" + titleCase(page_subsite.replace('-', ' ').replace('.html', '')) + "</a> > <a href='/" + page_subsite + "/" + page_directory + ".html'>" + titleCase(page_directory.replace('-', ' ').replace('.html', '')) + "</a> > <a target='blank' href='" + f.content_source + "'>" + titleCase(page_title.replace('-', ' ').replace('.html', '')) + " (source)</a>";
              } else {
                document.getElementById("page-title-table-path").innerHTML = "<a href='/" + page_subsite + ".html'>" + titleCase(page_subsite.replace('-', ' ').replace('.html', '')) + "</a> > <a href='/" + page_subsite + "/" + page_directory + ".html'>" + titleCase(page_directory.replace('-', ' ').replace('.html', '')) + "</a> > " + titleCase(page_title.replace('-', ' ').replace('.html', ''));
              }


// =========================================================================================
// Populating the page ATTRIBUTES
// =========================================================================================

              // Defining a table row with an image, populating it with JSON data, and appending it to the overview table
              if (f.img_rehosted != undefined && f.img_rehosted_source != undefined ) {

                // The image with a populated rehost and credit link upon clicking
                var table_row = "<tr><th colspan='2'><img id='page-attributes-table-image' alt='" + f.entry_name + "' target='blank' src='" + f.img_rehosted + "' onclick='window.open(`" + f.img_rehosted_source + "`)'></th></tr>";

                // Table Row #1
                $(table_row).appendTo("#page-attributes-table tbody");
              } else {

                // A default placeholder image that does activate when clicked
                var table_row = "<tr><th colspan='2'><img id='page-attributes-table-image' alt='" + f.entry_name + "' target='blank' src='/resources/images/WikiPlaceholder.png' onclick='window.open(this.src)'></th></tr>";

                // Table Row #1
                $(table_row).appendTo("#page-attributes-table tbody");
              }
              

              // Defining a table row with an image link, populating it with JSON data, and appending it to the overview table
              if (f.img_linked != undefined && f.img_linked_source != undefined) { 

                // Appending a table row with a link to the page art 
                var table_row = "<tr><th colspan='2'><i><a href='" + f.img_linked + "' target='_blank'>Additional Art</a> and <a href='" + f.img_linked_source + "' target='blank'>(source)</a></i></th></tr>";

                // Table Row #2
                $(table_row).appendTo("#page-attributes-table tbody");

              } else {
                // Appending a table row with a link to the page art 
                var table_row = "<tr><th colspan='2'><i>No Additional Art Available</a></i></th></tr>";
                
                // Table Row #2
                $(table_row).appendTo("#page-attributes-table tbody");
              }


              // Appending a table row with the creature name 
              var table_row = "<tr><th colspan='2'>" + f.entry_name + "</th></tr>";
              
              // Table Row #4
              $(table_row).appendTo("#page-attributes-table tbody");

              // Appending a table row with the creature type and category 
              if (f.entry_species != undefined) {
                
                // Appending a table row with the creature type and category 
                var table_row = "<tr><th colspan='2'>(" + f.entry_species + ")</th></tr>";
                
                // Table Row #5
                $(table_row).appendTo("#page-attributes-table tbody");
              } else {
                
                // Appending a table row with a default creature type and category 
                var table_row = "<tr><th colspan='2'>(Unknown Species)</th></tr>";
                
                // Table Row #5
                $(table_row).appendTo("#page-attributes-table tbody");
              }


              // Dynamically and adaptively populating overview table information from the JSON file 
              if (f.overview_table_groups != undefined) {
                for(var z = 0; f.overview_table_groups.length > z; z++) {
                  var table_row = "<tr><th colspan='2'>" + f.overview_table_groups[z].overview_table_group_heading + "</th></tr>";
                  $(table_row).appendTo("#page-attributes-table tbody");

                  if (f.overview_table_groups[z].overview_table_group_data != undefined) {
                    for(var y = 0; f.overview_table_groups[z].overview_table_group_data.length > y; y++) {
                      var table_row = "<tr><td>" + f.overview_table_groups[z].overview_table_group_data[y].heading + "</td><td>" + f.overview_table_groups[z].overview_table_group_data[y].content + "</td></tr>";
                      $(table_row).appendTo("#page-attributes-table tbody");
                    }
                  }
                }
              }


// =========================================================================================
// Populating the page DESCRIPTION
// =========================================================================================

              // Populating the page overview text
              if (f.entry_description_overview != undefined) {
                document.getElementById("page-description-div").innerHTML = "<p>" + f.entry_description_overview + "</p>";
              }


              // Checking if the page content library is present
              if (f.entry_description_library != undefined) {

                // Looping through all the library entries
                for(var x = 0; f.entry_description_library.length > x; x++) {

                  // Ensuring data exists
                  if (f.entry_description_library[x].heading != undefined && f.entry_description_library[x].content != undefined) {

                    // Populating the heading and content
                    document.getElementById("page-description-div").innerHTML += "<div id='" + f.entry_description_library[x].heading.toLowerCase().replace(/\s/g, '-').replace(`'`, ``) + "'><h3>" + f.entry_description_library[x].heading + "</h3></div><p>" + f.entry_description_library[x].content + "</p>";

                    // Checking for sublibrary
                    if (f.entry_description_library[x].sublibrary != undefined) {

                      // Looping through all entries
                      for(var w = 0; f.entry_description_library[x].sublibrary.length > w; w++) {

                        // Verifying content exists
                        if (f.entry_description_library[x].sublibrary[w].heading != undefined && f.entry_description_library[x].sublibrary[w].content != undefined) {

                          // Populating subheading and content
                          document.getElementById("page-description-div").innerHTML += "<div id='" + f.entry_description_library[x].sublibrary[w].heading.toLowerCase().replace(/\s/g, '-').replace(`'`, ``) + "'><h4>&#8226;  " + f.entry_description_library[x].sublibrary[w].heading + "</h4></div><p>" + f.entry_description_library[x].sublibrary[w].content + "</p>";
                        }
                      }
                    }
                  }
                }
              }
            }
          });
        });


// =========================================================================================
// Populating the page FOOTER
// =========================================================================================
        $("#import-footer").load("/resources/pages/import-footer.html");
      });
    </script>
  </head>


  <body>
    <!-- 
      A div for the page BACKGROUND 
    -->
    <div id="page-background-div">

      <!-- 
        A div for the HEADER 
      -->
      <div id="import-header"></div>
          
      <!-- 
        A section for the page CONTENT 
      -->
      <section class="page-content-section">

        <!-- 
          A table for the page TITLE 
        -->
        <table id="page-title-table">
          <thead><tr><td colspan="6"><h2 id="page-title-table-path"></h2></td></tr></thead>
          <tbody></tbody>
        </table>
                    
        <!-- 
          A table for the page ATTRIBUTES 
        -->
        <table id="page-attributes-table"><tbody></tbody></table>

        <!-- 
          A div for the page DESCRIPTION 
        -->
        <div id="page-description-div"></div>
      </section>
      
  
      <!-- 
        A div for the FOOTER 
      -->
      <footer id="import-footer"></footer>
    </div>
  </body>
</html>