<!DOCTYPE html>
<!-- =========================================================================================
  This is an ENTRY page.  It contains HEADER, BACKGROUND, CONTENT, and FOOTER elements that are standard across the site.
  It also contains TITLE, ATTRIBUTES, NAVLIST, and DESCRIPTION elements that are uniquely handled as an ENTRY page.
  The ENTRY page script reads the file path and discerns the following:  /<subsite>/<directory>/<page_name>
  The data is populated from a JSON file that is titled <directory>.JSON and stored within the <subsite> folder
  The data is populated from an entry within that JSON file if the entry_name attribute matches the <page_name>
 ========================================================================================= -->
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-US-Compatible" content="e-edge">
    <title>KnowOne's Website of Everything</title>
    <link rel="icon" href="/resources/images/OwlOfMinerva_ModifiedLogo.png">
    <link rel="stylesheet" href="/caped-crusaders-style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>  
    <script>

      // A function that capitalizes the first letter of each word in a string
      function titleCase(str) {
        var split_string = str.toLowerCase().split(' ');
        for (var i = 0; i < split_string.length; i++) {
          split_string[i] = split_string[i].charAt(0).toUpperCase() + split_string[i].substring(1);     
        }
        return split_string.join(' '); 
      }

      // The function that Hides and Shows the Navlist
      function hideShowNavList() {
        var hidden = '0px';
        var shown = '280px';

        // If the NAVLIST is already shown (which it will not be by default upon loading the page)
        if (document.getElementById('page-navlist-button').style.marginRight.includes(shown)) {

          // Set NAVLIST margins to the right and update button characters 
          document.getElementById('page-navlist-button').style.marginRight = hidden;
          document.getElementById('page-navlist-section').style.marginRight = '-280px';
          document.getElementById('page-navlist-button').innerHTML = '&#60; &#60;';

          // Animate NAVLIST elements from their Shown position to their recently updated Hidden position
          document.getElementById("page-navlist-section").animate([
            { transform: 'translateX(-280px)' },
            { transform: 'translateX(0px)' }
          ], {
            duration: 750,
            iterations: 1
          });
          document.getElementById("page-navlist-button").animate([
            { transform: 'translateX(-280px)' },
            { transform: 'translateX(0px)' }
          ], {
            duration: 750,
            iterations: 1
          });
        } else {

          // Set NAVLIST margins to the lefft and update button characters
          document.getElementById('page-navlist-button').style.marginRight = shown;
          document.getElementById('page-navlist-section').style.marginRight = '0px';
          document.getElementById('page-navlist-button').innerHTML = '&#62; &#62;';

          // Animate NAVLIST elements from their Hidden position to their recently updated Shown position
          document.getElementById("page-navlist-section").animate([
            { transform: 'translateX(280px)' },
            { transform: 'translateX(0px)' }
          ], {
            duration: 750,
            iterations: 1
          });
          document.getElementById("page-navlist-button").animate([
            { transform: 'translateX(280px)' },
            { transform: 'translateX(0px)' }
          ], {
            duration: 750,
            iterations: 1
          });
        }
      }


      // The function that populates all page data into preset elements
      $(function populatePageData() {


// =========================================================================================
// Populating the page HEADER
// 
// The page HEADER, BACKGROUND, CONTENT, and FOOTER are static
// =========================================================================================
        $("#import-header").load("/resources/pages/import-header.html");


// =========================================================================================
// Populating the page TITLE
// 
// The page TITLE can include a table of details for spells or monster statblocks
// If title_library does not have a table_row library, the table of details is hidden and only the TITLE path is populated
// =========================================================================================
        
        // Reading the name of this file
        var page_array = window.location.pathname.split("/");
        var page_array_length = page_array.length;

        if (page_array.length == 5) {
          var page_title = page_array.pop();
          var page_category = page_array.pop();
          var page_directory = page_array.pop();
          var page_subsite = page_array.pop();
          var page_site = page_array.pop();
        } else if (page_array.length == 4) {
          var page_title = page_array.pop();
          var page_directory = page_array.pop();
          var page_subsite = page_array.pop();
          var page_site = page_array.pop();
        } else if (page_array.length == 3) {
          var page_title = page_array.pop();
          var page_subsite = page_array.pop();
          var page_site = page_array.pop();
        } else if (page_array.length == 2) {
          var page_title = page_array.pop();
          var page_site = page_array.pop();
        } else if (page_array.length == 1) {
          var page_title = page_array.pop();
        } 

        if (page_subsite != undefined) {
          document.getElementById("page-title-path").innerHTML = "<a href='/" + page_subsite + ".html'>" + titleCase(page_subsite.replace('-', ' ').replace('.html', '')) + "</a>";
        } else {
          document.getElementById("page-title-path").innerHTML = titleCase(page_title.replace('-', ' ').replace('.html', ''));
        }
        if (page_directory != undefined) {
          document.getElementById("page-title-path").innerHTML += " > <a href='/" + page_subsite + "/" + page_directory + ".html'>" + titleCase(page_directory.replace('-', ' ').replace('.html', '')) + "</a>";
        }
        if (page_category != undefined) {
          document.getElementById("page-title-path").innerHTML += " > <a href='/" + page_subsite + "/" + page_directory + "/" + page_category + ".html'>" + titleCase(page_category.replace('-', ' ').replace('.html', '')) + "</a>";
        }

        // Reading data from our JSON file
        $.getJSON(`/` + page_subsite + `/` + page_directory + `.json`, function(data) {

          // Looping through the JSON data 
          $.each(data.entries, function(i, f) {

            // Finding the entry that matches this file
            if (f.entry_name.toLowerCase().replace(/\s/g, '-').replace("'", "") + ".html" == page_title) {

              if (f.content_source != undefined && f.content_source !== ""){
                document.getElementById("page-title-path").innerHTML += " > <a target='blank' href='" + f.content_source + "'>" + titleCase(page_title.replace('-', ' ').replace('.html', '')) + " (source)</a>";
              } else {
                document.getElementById("page-title-path").innerHTML += " > " + titleCase(page_title.replace('-', ' ').replace('.html', ''));
              }

              // // If Title Library Exists
              if (f.title_library != undefined) {
                for (var x = 0; f.title_library.length > x; x++) {
                  if (f.title_library[x].table_row != undefined) {
                    var table_row1 = "<tr>";
                    var table_row2 = "<tr>";
                    for (var y = 0; f.title_library[x].table_row.length > y; y++) {
                      if (f.title_library[x].table_row[y].heading != undefined && f.title_library[x].table_row[y].content != undefined && f.title_library[x].table_row[y].heading !== "" && f.title_library[x].table_row[y].content !== "") {
                        table_row1 += "<th style='width: 15vw'>" + f.title_library[x].table_row[y].heading + "</th>";
                        table_row2 += "<td style='width: 15vw'>" + f.title_library[x].table_row[y].content + "</td>";
                      }
                    }
                    table_row += "</tr>";
                    if (!table_row1.includes("<tr></tr>") && !table_row2.includes("<tr></tr>")) {
                      $(table_row1).appendTo("#page-title-table tbody");
                      $(table_row2).appendTo("#page-title-table tbody");
                    }
                  }
                }
              }


// =========================================================================================
// Populating the page ATTRIBUTES
// 
// The ATTRIBUTES table can include a table of details for wiki entries such as monsters or planescapes
// If attribute_library does not have a additional entries, the table of details is hidden and only the ATTRIBUTE image is populated
// =========================================================================================

              // If Attribute Library Exists
              if (f.attribute_library != undefined) {
                if (f.attribute_library[0] != undefined) {
                  
                  // Table Row #1:  Rehosted Art
                  if (f.attribute_library[0].img_rehosted != undefined && f.attribute_library[0].img_rehosted_source != undefined && f.attribute_library[0].img_rehosted !== "" && f.attribute_library[0].img_rehosted_source !== "") {
                    var table_row = "<tr><th colspan='2'><img id='page-attributes-table-image' alt='" + f.entry_name + "' target='blank' src='" + f.attribute_library[0].img_rehosted + "' onclick='window.open(`" + f.attribute_library[0].img_rehosted_source + "`)' style='display:block'></th></tr>";
                  } else {
                    var table_row = "<tr><th colspan='2'><img id='page-attributes-table-image' alt='" + f.entry_name + "' target='blank' src='/resources/images/WikiPlaceholder.png' onclick='window.open(this.src)'></th></tr>";
                  }
                  $(table_row).appendTo("#page-attributes-table tbody");
                  

                  // Table Row #2:  Linked Art
                  if (f.attribute_library[0].img_linked != undefined && f.attribute_library[0].img_linked_source != undefined && f.attribute_library[0].img_linked !== "" && f.attribute_library[0].img_linked_source !== "") { 
                    var table_row = "<tr><th colspan='2'><i><a href='" + f.attribute_library[0].img_linked + "' target='_blank'>Additional Art</a> and <a href='" + f.attribute_library[0].img_linked_source + "' target='blank'>(source)</a></i></th></tr>";
                  } else {
                    var table_row = "<tr><th colspan='2'><i>No Additional Art Available</a></i></th></tr>";
                  }
                  $(table_row).appendTo("#page-attributes-table tbody");


                  // If the library contains data for a wiki wtyle table
                  if (f.attribute_library[1] != undefined) {
                    
                    // Table Row #3:  Entry Name
                    var table_row = "<tr><th colspan='2'>" + f.entry_name + "</th></tr>";
                    $(table_row).appendTo("#page-attributes-table tbody");

                    // Table Row #4:  Species 
                    if (f.attribute_library[0].species != undefined && f.attribute_library[0].species !== "") {
                      var table_row = "<tr><th colspan='2'>(" + f.attribute_library[0].species + ")</th></tr>";
                    } else {
                      var table_row = "<tr><th colspan='2'>(Unknown Species)</th></tr>";
                    }
                    $(table_row).appendTo("#page-attributes-table tbody");


                    // Table Row(s) #5-n:  Attribute Details
                    for (var z = 0; f.attribute_library.length > z; z++) {
                      if (f.attribute_library[z].heading != undefined && f.attribute_library[z].sublibrary !== "") {
                        var table_row = "<tr><th colspan='2'>" + f.attribute_library[z].heading + "</th></tr>";
                        $(table_row).appendTo("#page-attributes-table tbody");
                        for (var y = 0; f.attribute_library[z].sublibrary.length > y; y++) {
                          if (f.attribute_library[z].sublibrary[y].subheading != undefined && f.attribute_library[z].sublibrary[y].subcontent != undefined && f.attribute_library[z].sublibrary[y].subheading !== "" && f.attribute_library[z].sublibrary[y].subcontent !== "") {
                            var table_row = "<tr><td>" + f.attribute_library[z].sublibrary[y].subheading + "</td><td>" + f.attribute_library[z].sublibrary[y].subcontent + "</td></tr>";
                            $(table_row).appendTo("#page-attributes-table tbody");
                          }
                        }
                      }
                    }
                  } 
                } else {
                  // Table Row #1:  Rehosted Art
                  var table_row = "<tr><th colspan='2'><img id='page-attributes-table-image' alt='" + f.entry_name + "' target='blank' src='/resources/images/WikiPlaceholder.png' onclick='window.open(this.src)'></th></tr>";
                  $(table_row).appendTo("#page-attributes-table tbody");
                  
                  // Table Row #2:  Linked Art
                  var table_row = "<tr><th colspan='2'><i>No Additional Art Available</a></i></th></tr>";
                  $(table_row).appendTo("#page-attributes-table tbody");
                }
              } else {
                // Table Row #1:  Rehosted Art
                var table_row = "<tr><th colspan='2'><img id='page-attributes-table-image' alt='" + f.entry_name + "' target='blank' src='/resources/images/WikiPlaceholder.png' onclick='window.open(this.src)'></th></tr>";
                $(table_row).appendTo("#page-attributes-table tbody");
                
                // Table Row #2:  Linked Art
                var table_row = "<tr><th colspan='2'><i>No Additional Art Available</a></i></th></tr>";
                $(table_row).appendTo("#page-attributes-table tbody");
              }


// =========================================================================================
// Populating the page DESCRIPTION and NAVLIST
// 
// The DESCRIPTION div can any number of headings and paragraphs
// The NAVLIST is updated with links to the DESCRIPTION headings as they are populated
// =========================================================================================

              // Populating the page title in the floating nav table
              var table_row = "<tr><th><a href='#page-title-table'>" + f.entry_name + "</a></th></tr>";
              $(table_row).appendTo("#page-navlist-table tbody");

              // If Description Library Exists
              if (f.description_library != undefined) {

                // Populating Description Overview underneath title table with no heading
                if (f.description_library[0].overview != undefined && f.description_library[0].overview !== "") {
                  document.getElementById("page-description-div").innerHTML = "<p>" + f.description_library[0].overview + "</p>";
                }

                // Looping through all Library entries
                for (var x = 0; f.description_library.length > x; x++) {

                  // Determining if Heading should be shown
                  if (f.description_library[x].content != undefined && f.description_library[x].content !== "") {
                    var showHeading = true;
                  } else if (f.description_library[x].sublibrary != undefined) {
                    for (var w = 0; f.description_library[x].sublibrary.length > w; w++) {
                      if (f.description_library[x].sublibrary[w].subheading != undefined && f.description_library[x].sublibrary[w].subcontent != undefined && f.description_library[x].sublibrary[w].subheading !== "" && f.description_library[x].sublibrary[w].subcontent !== "") {
                        var showHeading = true;
                      }
                    }
                  } else {
                    var showHeading = false;
                  }

                  // Populating Heading
                  if (f.description_library[x].heading != undefined && f.description_library[x].heading !== "" && showHeading) {
                    document.getElementById("page-description-div").innerHTML += "<div id='" + f.description_library[x].heading.toLowerCase().replace(/\s/g, '-').replace(`'`, ``) + "'><h3>" + f.description_library[x].heading + "</h3></div>";

                    // Populating the page heading in the floating nav table
                    var table_row = "<tr><td><a style='margin-left: 10px' href='#" + f.description_library[x].heading.toLowerCase().replace(/\s/g, '-').replace(`'`, ``) + "'>" + f.description_library[x].heading + "</a></td></tr>";
                    $(table_row).appendTo("#page-navlist-table tbody");

                    // Populating Heading Content
                    if (f.description_library[x].content != undefined && f.description_library[x].content !== "") {
                      document.getElementById("page-description-div").innerHTML += "<p>" + f.description_library[x].content + "</p>";
                    }

                    // If Sublibrary Exists
                    if (f.description_library[x].sublibrary != undefined) {

                      // Looping through all Sublibrary entries
                      for (var w = 0; f.description_library[x].sublibrary.length > w; w++) {

                        // Populating Subheading and Subcontent
                        if (f.description_library[x].sublibrary[w].subheading != undefined && f.description_library[x].sublibrary[w].subcontent != undefined && f.description_library[x].sublibrary[w].subheading !== "" && f.description_library[x].sublibrary[w].subcontent !== "") {
                          document.getElementById("page-description-div").innerHTML += "<div id='" + f.description_library[x].sublibrary[w].subheading.toLowerCase().replace(/\s/g, '-').replace(`'`, ``) + "'><h4>&#8226;  " + f.description_library[x].sublibrary[w].subheading + "</h4></div><p>" + f.description_library[x].sublibrary[w].subcontent + "</p>";

                          // Populating the page heading in the floating nav table
                          var table_row = "<tr><td><a style='margin-left: 20px' href='#" + f.description_library[x].sublibrary[w].subheading.toLowerCase().replace(/\s/g, '-').replace(`'`, ``) + "'>&#8226;  " + f.description_library[x].sublibrary[w].subheading + "</a></td></tr>";
                          $(table_row).appendTo("#page-navlist-table tbody");

                        }
                      }
                    }
                  }
                }
              }
            }
          });
        });


// =========================================================================================
// Populating the page FOOTER
// 
// The page HEADER, BACKGROUND, CONTENT, and FOOTER are static
// =========================================================================================
        $("#import-footer").load("/resources/pages/import-footer.html");
      });
    </script>
  </head>


  <body>
    <!-- 
      A div for the page BACKGROUND -->
    <div id="page-background-div">
      <!-- 
        A div for the page HEADER -->
      <div id="import-header"></div>
      <!-- 
        A series of element for the page NAVLIST -->
      <section id="page-navlist-section"><table id="page-navlist-table"><tbody></tbody></table></section>
      <button id='page-navlist-button' onclick='hideShowNavList()'>&#60; &#60;</button>
      <!-- 
        A section for the page CONTENT -->
      <section class="page-content-section">
        <!-- 
          A table for the page TITLE -->
        <table id="page-title-table"><thead><tr><td colspan="6"><h2 id="page-title-path"></h2></td></tr></thead><tbody></tbody></table>   
        <!-- 
          A table for the page ATTRIBUTES -->
        <table id="page-attributes-table"><tbody></tbody></table>
        <!-- 
          A div for the page DESCRIPTION -->
        <div id="page-description-div"></div>
      </section>
      <!-- 
        A div for the page FOOTER -->
      <footer id="import-footer"></footer>
    </div>
  </body>
</html>